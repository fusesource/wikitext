<?xml version="1.0" encoding="UTF-8"?>
<project name="mylyn" default="" basedir=".">
	<import file="scripts/buildHelper.xml" />
	<property file="defaults.properties" />
	
	<!-- base directory for eclipse sdk and eclipse test -->
	<property name="eclipse.base" value="." />
	
	<!-- working directory for building -->
	<property name="build.home" value="${basedir}/build" />
	
	<!-- directory for build artifacts -->
	<property name="build.results" value="${build.home}/results" />
	
	<!-- java sdk used for building -->
	<property name="jvm" value="${eclipse.base}/jvm/bin/java" />

	<property name="version" value="3.1.0" />
	
	<tstamp>
		<format property="qualifier" pattern="'I'yyyyMMdd-HH0" locale="en,US" timezone="UTC"/>
	</tstamp>
	
	<target name="init">
		<echo message="qualifier=${qualifier}" file="timestamp.properties"/>
		<echo message="Building Mylyn ${version}.${qualifier}" />
		
		<antcall target="forEach">
			<param name="call" value="get-helper"/>
		</antcall>		
	</target>

	<!--
	<target name="all" depends="clean-tests">
		<exec executable="./build-3.4.sh" />
		<exec executable="./run-tests-3.4.sh">
			<arg value="run" />
		</exec>
		<antcall target="report" />
		<exec executable="./run-tests-3.4.sh">
			<arg value="performance" />
		</exec>
		<antcall target="report" />

		<antcall target="publish" />

		<exec executable="./build-3.3.sh" />
		<exec executable="./run-tests-3.3.sh">
			<arg value="run" />
		</exec>
		<antcall target="report" />
		<exec executable="./run-tests-3.3.sh">
			<arg value="performance" />
		</exec>
		<antcall target="report" />
	</target>
	-->
	
	<target name="all" depends="init,clean,build,run-tests,run-performance-tests">
	</target>
	
	<target name="clean" depends="clean-tests">
		<antcall target="forEach">
			<param name="call" value="clean-build-helper"/>
		</antcall>
	</target>

	<target name="clean-tests">
		<antcall target="forEach">
			<param name="call" value="clean-tests-helper"/>
		</antcall>
	</target>

	<target name="report">
		<antcall target="forEach">
			<param name="call" value="report-helper"/>
		</antcall>
	</target>

	<target name="publish">
		<antcall target="publish-helper">
			<param name="eclipse.version" value="3.4"/>
		</antcall>
	</target>

	<target name="run-tests">
		<antcall target="forEach">
			<param name="call" value="run-tests-helper"/>
		</antcall>
	</target>

	<target name="run-performance-tests">
		<antcall target="forEach">
			<param name="call" value="run-performance-tests-helper"/>
		</antcall>
	</target>

	<target name="update-versions">
		<replace dir="..">
			<replacefilter 
			    token="3.1.0.qualifier"
				value="${version}.qualifier"/>
			<replacefilter 
			    token="3.1.0.mylynQualifier"
				value="${version}.mylynQualifier"/>
			<include name="org.eclipse.mylyn*/**/MANIFEST.MF"/>
			<include name="org.eclipse.mylyn*/**/feature.xml"/>
		</replace>
	</target>

	<target name="build" depends="init">
		<antcall target="forEach">
			<param name="call" value="build-helper"/>
		</antcall>
	</target>
	
	<target name="forEach">
		<antcall target="${call}">
			<param name="eclipse.version" value="3.3"/>
			<param name="eclipse.url" value="${eclipse.url.3.3}"/>
		</antcall>
		<antcall target="${call}">
			<param name="eclipse.version" value="3.4"/>
			<param name="eclipse.url" value="${eclipse.url.3.4}"/>
		</antcall>
		<antcall target="${call}">
			<param name="eclipse.version" value="3.5"/>
			<param name="eclipse.url" value="${eclipse.url.3.5}"/>
		</antcall>
	</target>
	
</project>