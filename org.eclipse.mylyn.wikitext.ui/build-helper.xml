<?xml version='1.0' encoding='utf-8'?>
<project name="org.eclipse.mylyn.wikitext.ui">
	
	<target name="clean">
		<delete>
			<fileset dir="help">
				<include name="**/*.html"/>
			</fileset>
		</delete>
	</target>
	
	<target name="all" depends="plugin-docs">
	</target>
	
	<target name="plugin-docs" description="generate plugin help documentation">
		<taskdef resource="org/eclipse/mylyn/wikitext/core/util/anttask/tasks.properties">
			<classpath>
				<pathelement location="../org.eclipse.mylyn.wikitext.core/@dot"/>
				<pathelement location="../org.eclipse.mylyn.wikitext.textile.core/@dot"/>
				<pathelement location="../org.eclipse.mylyn.wikitext.core/bin"/>
				<pathelement location="../org.eclipse.mylyn.wikitext.textile.core/bin"/>
			</classpath>
		</taskdef>
		<wikitext-to-eclipse-help markupLanguage="org.eclipse.mylyn.wikitext.textile.core.TextileLanguage" 
			multipleOutputFiles="true"
			navigationImages="true"
			helpPrefix="help">
			<fileset dir="help" includes="**/*.textile"/>
			<stylesheet url="book.css"/>
			<stylesheet file="${basedir}/help/styles/main.css"/>
		</wikitext-to-eclipse-help>
		
		<antcall target="test"/>
	</target>

	

	<target name="test" description="verify that all of the HTML files are well-formed XML">
		<echo level="info">
Validating help content XML and HTML files: The Eclipse help system expects well-formed XML
			
If validation fails it is because either:
			
* the userguide source code is poorly formed, or
* the WikiText MediaWiki parser has a bug
			
Problems with userguide source are usually caused by improper use of HTML markup in the MediaWiki source,
or inadvertently starting a line with a space character (in MediaWiki this starts a preformatted block)
		</echo>

		<!-- 
		Don't bother with DTD validation: we only care if the files are well-formed.
		We therefore provide an empty DTD 
		-->
		<mkdir dir="__tmp"/>
		<echo file="__tmp/__empty.dtd" message=""/>
		<xmlvalidate lenient="true">
			<fileset dir="help">
				<include name="**/*.xml"/>
			</fileset>
			<fileset dir="help">
				<include name="**/*.html"/>
			</fileset>
			<dtd publicid="-//W3C//DTD XHTML 1.0 Transitional//EN" location="${basedir}/__tmp/__empty.dtd"/>
		</xmlvalidate>
		<delete dir="__tmp"/>
	</target>
	
</project>
